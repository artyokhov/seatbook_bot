# Краткое описание

Это Telegram-бот для автоматизации бронирования рабочих мест в офисе.  
Бот используется как основной пользовательский интерфейс, а вся бизнес-логика и данные обрабатываются на сервере.

Система позволяет пользователям:
- регистрироваться в системе под одним из доступных ФИО (список сотрудников офиса СПБ)
- выбирать дату и доступное место на 14 календарных дней вперед
- создавать и отменять бронирования
- смотреть бронирования коллег
- приглашать в офис гостей
- в случае отсутствия свободных мест заявлять свое присутствие или присутствие гостя в офисе без места
- получать понятную обратную связь при конфликтах (место уже занято и т.п.).

Администраторам доступны сценарии контроля и вмешательства в бронирования без прямого доступа к базе данных:
- удалять бронирования
- добавлять / удалять пользователей (т.е. ФИО сотрудников)
- "высвобождать" уже занятое ФИО для повторной регистрации, т.е. отвязывать telegram id от ФИО.

Список администраторов определяется конфигурационным файлом.

Ключевые особенности:
- асинхронная архитектура для одновременной работы с несколькими пользователями
- хранение данных в реляционной базе
- хранение данных БД вне контейнера -> данные сохраняются при его перезапуске или пересборке
- автоматическая очистка устаревших данных по расписанию
- раздельное логгирование бизнес-событий и ошибок
- развертывание всех сред (разработка, тест, прод) на одной машине
- развертывание СУБД инициализирующими скриптами через docker-compose и вспомогательные скрипты в entrypoint, без ручной настройки схемы на сервере (миграции автоматизировать не удалось).

# TO DO

- Повторяющийся шаблон построения текста бронирований реализовать общей функцией
- Повторяющийся шаблон построения клавиатур с пагинацией реализовать общей функцией
- Удаление брони: реализовать проверку что удаляющий является владельцем брони или админом
- Добавить описание типов в функциях: Callable, Awaitable
- Реализовать идемпотентность случайных двойных нажатий по кнопке (сейчас возникает error, а нужно сообщение вида "Уже обработано...")
- Во всех коллбеках использующих BookingService отказаться от получения данных пользователя отдельным запросом и реализовать получение данных пользователя через JOIN внутри запроса данных бронирований
- Реализовать логику опроса владельцев бронирований об их намерении прийти в офис и удаления броней в случае отсутствия подтверждения
- Реализовать логику: в случае появления свободных мест, опросить людей, имеющих бронирования без места, предложив забронировать место, перебором в зависимости от даты создания бронирования без места
- Реализовать логику доставки лога ошибок админу если ошибки появились за сутки
- Реализовать логику просмотра лога бизнес-событий админом
- Настройка миграций через Alembic
- Реализовать логику передачи доп.изображения в сообщении по коллбеку to_start чтобы избавиться от протухания сообщения перед вызовом delete_message() (или всегда и везде передавать какое-то изображение и использовать только edit_message_media() и edit_message_caption())
- Описать бизнес-логику
